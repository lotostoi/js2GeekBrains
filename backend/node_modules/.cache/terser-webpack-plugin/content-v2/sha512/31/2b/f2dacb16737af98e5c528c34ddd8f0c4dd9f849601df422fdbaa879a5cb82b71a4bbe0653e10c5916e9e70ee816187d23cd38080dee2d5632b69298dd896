{"code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"/\",n(n.s=3)}([function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"express\")},function(e,t,n){const{Schema:r,model:o}=n(0),i=new r({title:{type:String,required:!0},price:{type:Number,required:!0},img:{type:String,required:!0},description:{type:String,required:!0}});e.exports=o(\"ListGoods\",i)},function(e,t,n){(function(e){const t=\"isProdaction\"in process&&process.isProdaction,r=t?\"/\":\"/api\",o=n(4),i=n(5),a=n(1),s=n(0);s.set(\"useFindAndModify\",!1);const d=n(6),c=n(7),u=a();if(t){const t=n(11);u.use(t()),u.use(a.static(o.join(e,\"static\")))}u.use(a.urlencoded({extended:!1})),u.use(i.json()),u.use(r,d),u.use(r,c),t&&u.get(\"*\",((e,t)=>{console.log(e.path),t.end(e.path)})),async function(){try{const e=\"mongodb+srv://lotos_toi:G0fdQ7GKoTODMmRM@cluster0.n6oze.mongodb.net/jsSecondCourseGeekBarins?retryWrites=true&w=majority\";await s.connect(e,{useNewUrlParser:!0,useUnifiedTopology:!0}),u.listen(3e3,(()=>console.log(\"Server has been started...\")))}catch(e){console.error(e)}}()}).call(this,\"/\")},function(e,t){e.exports=require(\"path\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t,n){const r=n(1).Router(),o=n(2);r.get(\"/goods\",(async(e,t)=>{const n=await o.find();t.json(n)})),e.exports=r},function(e,t,n){const r=n(1),o=n(8),i=r.Router(),a=n(9),s=n(2),d=n(10);i.get(\"/cartGoods\",(async(e,t)=>{const n=await a.find();t.json(n)})),i.post(\"/add\",(async(e,t)=>{let n=e.body.id;try{let e=await s.findById(n);await a({_id:e._id,title:e.title,price:e.price,quantity:1,img:e.img,description:e.description}).save(),await d({event:\"Adding to cart\",product:e,data:o()}).save(),t.json({result:1})}catch(e){t.status(404).end()}})),i.put(\"/inc\",(async(e,t)=>{let n=e.body.id;try{let e=await a.findById(n);e&&(await a.findByIdAndUpdate(n,{$set:{quantity:++e.quantity}},{new:!0}),await d({event:\"Increase of quantity of good\",product:e,data:o()}).save(),t.json({result:1}))}catch(e){t.status(404).end()}})),i.put(\"/dec\",(async(e,t)=>{let n=e.body.id;try{let e=await a.findById(n);await a.findByIdAndUpdate(n,{$set:{quantity:--e.quantity}},{new:!0}),await d({event:\"Decrease of quantity of good\",product:e,data:o()}).save(),t.json({result:1})}catch(e){t.status(404).end()}})),i.delete(\"/remove/:id\",(async(e,t)=>{let n=e.params.id;try{let e=await a.findById(n);await a.findByIdAndDelete(n),await d({event:\"Deleting form cart\",product:e,data:o()}).save(),t.json({result:1})}catch(e){console.log(e),t.status(404).end()}})),i.delete(\"/delAll\",(async(e,t)=>{try{await a.deleteMany(),await d({event:\"Clearing the entire cart\",product:null,data:o()}).save(),t.json({result:1})}catch(e){t.status(404).end()}})),i.get(\"/statistics\",(async(e,t)=>{try{let e=await d.find();t.json(e.sort(c))}catch(e){console.log(e),t.status(404).end()}})),e.exports=i;const c=(e,t)=>new Date(e.data)<new Date(t.data)?1:new Date(e.data)>new Date(t.data)?-1:new Date(e.data)===new Date(t.data)?0:void 0},function(e,t){e.exports=require(\"moment\")},function(e,t,n){const{Schema:r,model:o}=n(0),i=new r({_id:{type:String,required:!0},title:{type:String,required:!0},price:{type:Number,required:!0},img:{type:String,required:!0},quantity:{type:Number,required:!0},description:{type:String,required:!0}});e.exports=o(\"CartGoods\",i)},function(e,t,n){const{Schema:r,model:o}=n(0),i=new r({event:{type:String,required:!0},product:{type:Object,required:!1},data:{type:String,required:!0}});e.exports=o(\"Statistics\",i)},function(e,t){e.exports=require(\"connect-history-api-fallback\")}]);","name":"js/index.js","input":"/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 3);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"mongoose\");\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"express\");\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\r\n\r\nconst { Schema, model } = __webpack_require__(0)\r\n\r\nconst good = new Schema({\r\n    title: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    price: {\r\n        type: Number,\r\n        required: true\r\n    },\r\n    img: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    description: {\r\n        type: String,\r\n        required: true\r\n    },\r\n\r\n})\r\n\r\nmodule.exports = model('ListGoods', good)\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(__dirname) {const PORT = 3000\r\n// for build\r\nconst isProd = ('isProdaction' in process) && process.isProdaction\r\n\r\nconst urlForProxy = isProd ? '/' : '/api'\r\n\r\nconst path = __webpack_require__(4)\r\n\r\n\r\n\r\nconst bodyParser = __webpack_require__(5);\r\n\r\nconst express = __webpack_require__(1)\r\nconst mongoose = __webpack_require__(0)\r\nmongoose.set('useFindAndModify', false)\r\n\r\n// import routers\r\nconst listGoodsRout = __webpack_require__(6)\r\nconst listCartRout = __webpack_require__(7)\r\n\r\nconst app = express()\r\n\r\nif (isProd) {\r\n    const history = __webpack_require__(11);\r\n    app.use(history())\r\n    app.use(express.static(path.join(__dirname, 'static')));\r\n}\r\n\r\napp.use(express.urlencoded({ extended: false }))\r\napp.use(bodyParser.json());\r\n\r\n\r\napp.use(urlForProxy, listGoodsRout)\r\napp.use(urlForProxy, listCartRout)\r\n\r\nif (isProd) {\r\n    app.get('*', (req, res) => {\r\n        console.log(req.path)\r\n        res.end(req.path)\r\n    })\r\n}\r\n\r\n\r\n\r\nasync function start() {\r\n    try {\r\n\r\n        const link = 'mongodb+srv://lotos_toi:G0fdQ7GKoTODMmRM@cluster0.n6oze.mongodb.net/jsSecondCourseGeekBarins?retryWrites=true&w=majority'\r\n\r\n        await mongoose.connect(link, { useNewUrlParser: true, useUnifiedTopology: true })\r\n\r\n        app.listen(PORT, () => console.log('Server has been started...'))\r\n\r\n    }\r\n    catch (e) {\r\n        console.error(e)\r\n    }\r\n\r\n}\r\n\r\n\r\nstart()\n/* WEBPACK VAR INJECTION */}.call(this, \"/\"))\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"path\");\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"body-parser\");\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\nconst express = __webpack_require__(1);\r\nconst router = express.Router();\r\nconst ListGoods = __webpack_require__(2)\r\n\r\nrouter.get('/goods', async (req, res) => {\r\n    const goods = await ListGoods.find()\r\n    res.json(goods)\r\n})\r\n\r\nmodule.exports = router\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\nconst express = __webpack_require__(1);\r\nconst moment = __webpack_require__(8)\r\nconst router = express.Router();\r\nconst CartGoods = __webpack_require__(9)\r\nconst ListGoods = __webpack_require__(2)\r\nconst CartStatistics = __webpack_require__(10)\r\n\r\nrouter.get('/cartGoods', async (req, res) => {\r\n    const cartGoods = await CartGoods.find()\r\n    res.json(cartGoods)\r\n})\r\n\r\nrouter.post('/add', async (req, res) => {\r\n\r\n    let id = req.body.id\r\n\r\n    try {\r\n\r\n        let good = await ListGoods.findById(id)\r\n        await CartGoods({\r\n            _id: good._id,\r\n            title: good.title,\r\n            price: good.price,\r\n            quantity: 1,\r\n            img: good.img,\r\n            description: good.description\r\n        }).save()\r\n\r\n        await CartStatistics({\r\n            event: 'Adding to cart',\r\n            product: good,\r\n            data: moment()\r\n        }).save()\r\n\r\n        res.json({ result: 1 })\r\n\r\n    } catch (e) {\r\n        res.status(404).end()\r\n    }\r\n\r\n})\r\nrouter.put('/inc', async (req, res) => {\r\n\r\n    let id = req.body.id\r\n    try {\r\n        let good = await CartGoods.findById(id)\r\n        if (good) {\r\n            await CartGoods.findByIdAndUpdate(id, { $set: { quantity: ++good.quantity } }, { new: true })\r\n            await CartStatistics({\r\n                event: 'Increase of quantity of good',\r\n                product: good,\r\n                data: moment()\r\n            }).save()\r\n\r\n            res.json({ result: 1 })\r\n        }\r\n    } catch (e) {\r\n        res.status(404).end()\r\n    }\r\n\r\n})\r\nrouter.put('/dec', async (req, res) => {\r\n\r\n    let id = req.body.id\r\n    try {\r\n        let good = await CartGoods.findById(id)\r\n        await CartGoods.findByIdAndUpdate(id, { $set: { quantity: --good.quantity } }, { new: true })\r\n        await CartStatistics({\r\n            event: 'Decrease of quantity of good',\r\n            product: good,\r\n            data: moment()\r\n        }).save()\r\n        res.json({ result: 1 })\r\n\r\n    } catch (e) {\r\n        res.status(404).end()\r\n    }\r\n\r\n})\r\nrouter.delete('/remove/:id', async (req, res) => {\r\n\r\n    let id = req.params.id\r\n    try {\r\n        let good = await CartGoods.findById(id)\r\n        await CartGoods.findByIdAndDelete(id)\r\n        await CartStatistics({\r\n            event: 'Deleting form cart',\r\n            product: good,\r\n            data: moment()\r\n        }).save()\r\n        res.json({ result: 1 })\r\n\r\n    } catch (e) {\r\n        console.log(e)\r\n        res.status(404).end()\r\n    }\r\n\r\n})\r\nrouter.delete('/delAll', async (req, res) => {\r\n    try {\r\n        await CartGoods.deleteMany()\r\n        await CartStatistics({\r\n            event: 'Clearing the entire cart',\r\n            product: null,\r\n            data: moment()\r\n        }).save()\r\n        res.json({ result: 1 })\r\n\r\n    } catch (e) {\r\n        res.status(404).end()\r\n    }\r\n})\r\nrouter.get('/statistics', async (req, res) => {\r\n    try {\r\n\r\n        let statistics = await CartStatistics.find()\r\n        res.json(statistics.sort(sortByDate))\r\n\r\n    } catch (e) {\r\n        console.log(e)\r\n        res.status(404).end()\r\n    }\r\n})\r\n\r\nmodule.exports = router\r\n\r\nconst sortByDate = (a, b) => {\r\n    if (new Date(a.data) < new Date(b.data)) return 1\r\n    if (new Date(a.data) > new Date(b.data)) return -1\r\n    if (new Date(a.data) === new Date(b.data)) return 0\r\n}\r\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"moment\");\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\r\n\r\nconst { Schema, model } = __webpack_require__(0)\r\n\r\nconst good = new Schema({\r\n    _id: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    title: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    price: {\r\n        type: Number,\r\n        required: true\r\n    },\r\n    img: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    quantity: {\r\n        type: Number,\r\n        required: true\r\n    },\r\n    description: {\r\n        type: String,\r\n        required: true\r\n    },\r\n\r\n})\r\n\r\nmodule.exports = model('CartGoods', good)\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\nconst { Schema, model } = __webpack_require__(0)\r\n\r\nconst good = new Schema({\r\n    event: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    product: {\r\n        type: Object,\r\n        required: false\r\n    },\r\n    data: {\r\n        type: String,\r\n        required: true\r\n    },\r\n})\r\n\r\nmodule.exports = model('Statistics', good)\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports) {\n\nmodule.exports = require(\"connect-history-api-fallback\");\n\n/***/ })\n/******/ ]);","inputSourceMap":null}