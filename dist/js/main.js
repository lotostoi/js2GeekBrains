!function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(t,e,r){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r=t[1]||"",a=t[3];if(!a)return r;if(e&&"function"==typeof btoa){var n=(o=a,s=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),i=a.sources.map((function(t){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(t," */")}));return[r].concat(i).concat([n]).join("\n")}var o,s,c;return[r].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r,a){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(a)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(n[o]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);a&&n[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),e.push(c))}},e}},function(t,e,r){var a=r(2),n=r(3);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);var i={insert:"head",singleton:!1};a(n,i);t.exports=n.locals||{}},function(t,e,r){"use strict";var a,n=function(){return void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a},i=function(){var t={};return function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}t[e]=r}return t[e]}}(),o=[];function s(t){for(var e=-1,r=0;r<o.length;r++)if(o[r].identifier===t){e=r;break}return e}function c(t,e){for(var r={},a=[],n=0;n<t.length;n++){var i=t[n],c=e.base?i[0]+e.base:i[0],d=r[c]||0,l="".concat(c," ").concat(d);r[c]=d+1;var u=s(l),h={css:i[1],media:i[2],sourceMap:i[3]};-1!==u?(o[u].references++,o[u].updater(h)):o.push({identifier:l,updater:m(h,e),references:1}),a.push(l)}return a}function d(t){var e=document.createElement("style"),a=t.attributes||{};if(void 0===a.nonce){var n=r.nc;n&&(a.nonce=n)}if(Object.keys(a).forEach((function(t){e.setAttribute(t,a[t])})),"function"==typeof t.insert)t.insert(e);else{var o=i(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var l,u=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function h(t,e,r,a){var n=r?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(t.styleSheet)t.styleSheet.cssText=u(e,n);else{var i=document.createTextNode(n),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}function p(t,e,r){var a=r.css,n=r.media,i=r.sourceMap;if(n?t.setAttribute("media",n):t.removeAttribute("media"),i&&btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleSheet)t.styleSheet.cssText=a;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(a))}}var f=null,g=0;function m(t,e){var r,a,n;if(e.singleton){var i=g++;r=f||(f=d(e)),a=h.bind(null,r,i,!1),n=h.bind(null,r,i,!0)}else r=d(e),a=p.bind(null,r,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(r)};return a(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;a(t=e)}else n()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=n());var r=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var a=0;a<r.length;a++){var n=s(r[a]);o[n].references--}for(var i=c(t,e),d=0;d<r.length;d++){var l=s(r[d]);0===o[l].references&&(o[l].updater(),o.splice(l,1))}r=i}}}},function(t,e,r){"use strict";r.r(e);var a=r(0),n=r.n(a)()(!1);n.push([t.i,"body{margin:0;padding:0;font-size:14px}.wrapper{width:100%;max-width:1200px;margin:0 auto}main{width:100%;display:flex;flex-direction:column}header{display:flex;min-height:30px;background-color:#000;padding:20px;justify-content:space-between}header>a{display:flex;text-decoration:none;font-size:2em;color:#d4d3d3}header>a:hover{color:orange}header>a:active{color:#a06904}header>button{display:flex;align-items:center;justify-content:center;width:100px;outline:none;border:none;border-radius:3px;transition:transform .3}header>button:hover{color:orange;background-color:#535353}header>button:active{transform:scale(0.9)}header>button>span{margin-left:5px;display:flex;justify-content:center;align-items:center;width:30px;height:20px;border-radius:20%;background-color:#d2691e}.products{display:flex;width:100%;flex-wrap:wrap;justify-content:space-evenly;padding:20px;margin-top:10px;border:1px solid #cecdcd;box-sizing:border-box}.product-item{align-items:center;display:flex;flex-direction:column;width:25%;border:1px solid gray;padding:20px 0;margin-bottom:20px;-webkit-box-shadow:0px 0px 5px 0px rgba(0,0,0,.75);-moz-box-shadow:0px 0px 5px 0px rgba(0,0,0,.75);box-shadow:0px 0px 5px 0px rgba(0,0,0,.75)}.product-item button{margin:5px 0;cursor:pointer;display:flex;align-items:center;justify-content:center;width:100px;outline:none;border:none;border-radius:3px;transition:transform .3;background-color:#cecccc}.product-item button:hover{color:orange;background-color:#535353}.product-item button:active{transform:scale(0.9)}.cart{position:fixed;width:100vw;height:100vh;display:none;background-color:rgba(128,128,128,.678);padding:20px;box-sizing:border-box;justify-content:center;align-items:center}.cart__close{cursor:pointer;display:flex;width:30px;height:30px;border-radius:50%;justify-content:center;align-items:center;color:#fff;background-color:rgba(0,0,0,.788);position:absolute;top:30px;right:30px}.cart__close:hover{background-color:#c72306}.cart__close:active{transform:scale(0.9)}.cart__body{position:relative;-webkit-box-shadow:0px 0px 5px 0px rgba(0,0,0,.75);-moz-box-shadow:0px 0px 5px 0px rgba(0,0,0,.75);box-shadow:0px 0px 5px 0px rgba(0,0,0,.75);display:flex;flex-direction:column;width:50vw;max-height:70vh;padding:20px;box-sizing:border-box;background-color:#11abda;overflow-y:auto}.cart__body>hr{width:100%}.cart__headerBody{width:100%;display:flex;height:40px}.cart__headerBody p{display:flex;display:flex;justify-content:center;align-items:center}.cart__headerBody p.colImage{width:20%}.cart__headerBody p.colTitle{width:20%}.cart__headerBody p.colPrice{width:20%}.cart__headerBody p.colAllPrice{width:20%}.cart__headerBody p.colQuantity{width:20%}.cart__products{display:flex;width:100%;flex-direction:column}.cart__prodact{margin:5px 0;display:flex;width:100%}.cart__imgCont,.cart__title,.cart__price,.cart__all-price,.cart__quantity{display:flex;justify-content:center;align-items:center;width:20%}.cart__quantity>span{margin:0 10px}.cart__resalts>button{cursor:pointer;background-color:gray;outline:none;border:none;color:#000;padding:10px;font-size:1.2em;border-radius:3px}.cart__resalts>button:hover{background-color:#c72306}.cart__resalts>button:active{transform:scale(0.9)}.cart-active{display:flex}",""]),e.default=n},function(t,e,r){"use strict";r.r(e);r(1);var a=class{constructor(t,e="http://placehold.it/150x200/"){let{id:r,title:a,price:n}=t;this.id=r,this.title=a,this.price=n,this.img=e}rander(){return`<div class="product-item" data-id="${this.id}">\n                  <img src="${this.img}" alt="Some img">\n                    <div class="desc">\n                        <h3>${this.title}</h3>\n                        <p>${this.price} ₽</p>\n                        <button class="addToCart" data-id="${this.id}">Add to cart</button>\n                        <button class="dellFromCart" data-id="${this.id}">Remove</button>\n                    </div>\n                </div>`}};var n=class extends a{constructor(t,e="http://placehold.it/100x100/"){super(t,e),this.quantity=t.quantity}rander(){return`                \n                <div class="cart__prodact" data-id="${this.id}">\n\n                    <div class = "cart__imgCont">\n\n                        <img class="cart__img" src="${this.img}" alt="${this.title}">\n\n                    </div>\n\n                    <h3 class = "cart__title" data-name="${this.id}">${this.title} </h3>\n\n                    <span class="cart__price" data-price="${this.id}">${this.price}₽</span>\n\n                    <span class="cart__all-price" data-all-price="${this.id}">${this.quantity*this.price} ₽</span>\n\n                    <div class="cart__quantity">\n\n                        <button data-inc="${this.id}"> + </button>\n\n                        <span data-quantity="${this.id}">${this.quantity}</span>\n\n                        <button data-dec="${this.id}"> - </button>\n\n                    </div>\n\n                </div>`}};const i="https://raw.githubusercontent.com/lotostoi/js2GeekBrains/lesson3/responses/";var o={catalog:i+"catalogData.json",cart:i+"getBasket.json",addCart:i+"addToBasket.json",delCart:i+"deleteFromBasket.json"};var s=class{constructor(t=".cart__products"){this.container=document.querySelector(t),this._goodsInCart=[],this.prodCart=[],this.cartCont=document.querySelector(".cart"),this.allSum=document.querySelector(".allsum"),this.closeCart=document.querySelector(".cart__close"),this.showCart=document.querySelector(".btn-cart"),this.Quantity=document.querySelector(".allquantity"),this.Amount=document.querySelector(".amount"),this._init()}async _init(){await this._fetchGoodsInCart(),this._addcalc(),this._handler()}_addcalc(){this.allSum.innerHTML=this.calcAllCart().allSum,this.Quantity.innerHTML=this.calcAllCart().allQuantity,this.Amount.innerHTML=this.calcAllCart().allQuantity,this.rander()}async _fetchGoodsInCart(){let t=await fetch(o.cart);t=await t.json(),this._goodsInCart=t.contents}rander(){this.container.innerHTML="";for(let t of this._goodsInCart){const e=new n(t);this.container.insertAdjacentHTML("beforeend",e.rander())}}async addToCart(t){let e=await fetch(o.addCart);e=await e.json(),this._isInCartId(t.id)||1!==e.result||(t.quantity=1,this._goodsInCart.push(t),this._addcalc())}async removeFromCart(t){let e=await fetch(o.delCart);if(e=await e.json(),this._isInCartId(t.id)&&1===e.result){let e=this._indexInCartId(t.id);this._goodsInCart.splice(e,1),this._addcalc()}}async incCart(t){let e=await fetch(o.addCart);if(e=await e.json(),this._isInCartId(t)&&1===e.result){let e=this._indexInCartId(t);this._goodsInCart[e].quantity++,this._addcalc()}}async decCart(t){let e=await fetch(o.delCart);if(e=await e.json(),this._isInCartId(t)&&1===e.result){let e=this._indexInCartId(t);1==this._goodsInCart[e].quantity?this._goodsInCart.splice(e,1):this._goodsInCart[e].quantity--,this._addcalc()}}async claerCart(){let t=await fetch(o.delCart);t=await t.json(),1===t.result&&(this._goodsInCart=[],this._addcalc())}calcAllCart(){return{allQuantity:this._goodsInCart.reduce((t,e)=>t+e.quantity,0),allSum:this._goodsInCart.reduce((t,e)=>t+e.quantity*e.price,0)}}_isInCartId(t){return this._goodsInCart.find(e=>e.id==t)}_indexInCartId(t){return this._goodsInCart.findIndex(e=>e.id==t)}_handler(){this.cartCont.addEventListener("click",t=>{if(t.target.dataset.inc){let e=t.target.dataset.inc;this.incCart(e)}if(t.target.dataset.dec){let e=t.target.dataset.dec;this.decCart(e)}"claerCart"===t.target.id&&this.claerCart()});let t=function(){this.cartCont.classList.toggle("cart-active")}.bind(this);this.closeCart.addEventListener("click",t),this.showCart.addEventListener("click",t)}};var c=t=>new Promise((e,r)=>{let a=new XMLHttpRequest;a.open("GET",t,!0),a.onreadystatechange=()=>{4===a.readyState&&(200!==a.status?r("Error"):e(a.responseText))},a.send()});new class{constructor(t=".products"){this.container=document.querySelector(t),this._goods=[],this.allGoods=[],this.resolve,this.cart=new s,this.ready(),this._init()}ready(){return new Promise(t=>{this.resolve=t})}async _init(){await this._fetchGoods(),this._rander(),this._handler()}async _fetchGoods(){let t=await c(o.catalog);this._goods=await JSON.parse(t)}_rander(){for(let t of this._goods){const e=new a(t);this.allGoods.push(e),this.container.insertAdjacentHTML("beforeend",e.rander())}this.resolve()}_handler(){this.container.addEventListener("click",t=>{if("addToCart"===t.target.className){let e=t.target.dataset.id;this.cart.addToCart(this.allGoods.find(t=>t.id.toString()===e.toString()))}if("dellFromCart"===t.target.className){let e=t.target.dataset.id;this.cart.removeFromCart(this.allGoods.find(t=>t.id.toString()===e.toString()))}})}async allSummAllGoods(){return await this.ready(),this.allGoods.length>0?this.allGoods.reduce((t,e)=>t+e.price,0):0}}}]);